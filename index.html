<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>æ‹çˆ±å±æœºï¼š12.24 å¹³å®‰å¤œå…¨æ¨¡æ‹Ÿ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;700;900&display=swap');
        
        :root {
            --ios-blur: blur(25px);
            --ios-border: rgba(0, 0, 0, 0.08);
            --bg-light: #f2f2f7;
        }

        body { 
            font-family: -apple-system, 'Noto Sans SC', sans-serif; 
            background-color: var(--bg-light);
            color: #1d1d1f;
            position: fixed;
            width: 100%;
            height: 100%;
            overflow: hidden;
            -webkit-font-smoothing: antialiased;
        }

        .action-section { height: 13vh; margin-top: 1vh; flex-shrink: 0; padding: 0 16px; }
        .progress-indicator-section { height: 8vh; flex-shrink: 0; display: flex; flex-direction: column; justify-content: center; gap: 6px; padding: 0 20px; }
        .insight-section { height: 6vh; flex-shrink: 0; padding: 0 16px; margin-top: 4px; }
        .thought-section { height: 20vh; flex-shrink: 0; padding: 0 16px; margin-top: 8px; }
        .scene-section { height: 38vh; flex-shrink: 0; padding: 0 16px; margin-top: 8px; padding-bottom: env(safe-area-inset-bottom); }

        .ios-card {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: var(--ios-blur);
            -webkit-backdrop-filter: var(--ios-blur);
            border: 1px solid var(--ios-border);
            border-radius: 22px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.04);
            transition: all 0.6s cubic-bezier(0.23, 1, 0.32, 1);
        }

        .time-box {
            background: #fff;
            border: 1.5px solid #000;
            padding: 4px 12px;
            border-radius: 12px;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
        }

        .thought-bubble {
            padding: 16px;
            font-size: 13px;
            font-weight: 400;
            line-height: 1.6;
            height: 100%;
            display: flex;
            align-items: flex-start;
            flex-direction: column;
            letter-spacing: -0.01em;
            color: #3a3a3c;
            overflow-y: auto;
        }

        .panel { flex: 1; display: flex; flex-direction: column; position: relative; }

        .nav-btn {
            position: fixed;
            top: 45%;
            transform: translateY(-50%);
            width: 54px;
            height: 54px;
            border-radius: 27px;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 100;
            transition: all 0.3s cubic-bezier(0.17, 0.67, 0.83, 0.67);
            cursor: pointer;
        }
        #floatingNextBtn { right: 16px; background: #000; color: white; box-shadow: 0 12px 30px rgba(0,0,0,0.2); }
        #floatingPrevBtn { left: 16px; background: rgba(255,255,255,0.9); color: #000; border: 1px solid rgba(0,0,0,0.1); backdrop-filter: blur(10px); }
        .nav-btn:active { transform: translateY(-50%) scale(0.9); }
        #floatingNextBtn.final { width: auto; padding: 0 28px; border-radius: 20px; }

        .progress-bar { height: 6px; background: rgba(0,0,0,0.06); border-radius: 10px; overflow: hidden; width: 100%; margin-top: 4px; }
        .progress-fill { transition: all 1s cubic-bezier(0.34, 1.56, 0.64, 1); height: 100%; width: 0; }
        .bar-label { font-size: 10px; font-weight: 700; color: #8e8e93; display: flex; justify-content: space-between; }

        .emoji-scene { font-size: 80px; width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; background: linear-gradient(135deg, #fdfbfb 0%, #ebedee 100%); border-radius: 18px; }
        
        @keyframes vibrate {
            0% { transform: translateX(0); }
            25% { transform: translateX(-1px); }
            50% { transform: translateX(1px); }
            100% { transform: translateX(0); }
        }
        .vibrate { animation: vibrate 0.1s linear infinite; }
    </style>
</head>
<body>

    <!-- å¯¼èˆª -->
    <div id="floatingPrevBtn" class="nav-btn" style="display:none">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><line x1="19" y1="12" x2="5" y2="12"></line><polyline points="12 19 5 12 12 5"></polyline></svg>
    </div>
    <div id="floatingNextBtn" class="nav-btn" style="display:none">
        <svg id="arrowIcon" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>
        <span id="finalText" class="hidden text-xs font-bold tracking-widest ml-2 uppercase">Alen çš„äº²ç¬”é“æ­‰ä¿¡</span>
    </div>

    <!-- å°é¢ -->
    <div id="introOverlay" class="fixed inset-0 flex flex-col items-center justify-center p-8 bg-[#f2f2f7] z-[1000]">
        <div class="ios-card p-12 mb-10 flex flex-col items-center text-slate-900 relative bg-white w-80">
            <div class="absolute top-0 left-0 w-full h-1.5 bg-red-500 rounded-t-3xl"></div>
            <h1 class="text-xl font-black tracking-tight mb-4 text-center">12.24 å¹³å®‰å¤œ<br>æ‹çˆ±å±æœºæº¯æºæ¨¡æ‹Ÿå™¨</h1>
            <p class="text-[10px] tracking-[0.4em] font-bold text-slate-400 uppercase">Version 6.0 | äº²ç¬”é“æ­‰ç‰ˆ</p>
        </div>
        <button id="startBtn" class="bg-black text-white px-14 py-4 rounded-full text-xs font-bold tracking-[0.2em] uppercase shadow-2xl">å¼€å§‹æ•°æ®å¤ç°</button>
    </div>

    <header class="h-20 flex items-end justify-between px-6 pb-2 flex-none">
        <div class="flex items-center space-x-3">
            <div class="time-box">
                <span class="text-[10px] font-black text-slate-400 uppercase tracking-tighter">TIME</span>
                <span id="currentTime" class="text-[18px] font-black tracking-widest text-black font-mono">--:--</span>
            </div>
            <div class="flex flex-col">
                <span id="sceneTitle" class="text-[13px] font-bold text-black tracking-tight tracking-widest">åˆå§‹åŒ–æ•°æ®...</span>
            </div>
        </div>
    </header>

    <main class="flex-1 flex flex-col relative">
        <!-- è¡ŒåŠ¨ -->
        <div class="action-section flex gap-3">
            <div class="panel ios-card p-5 justify-center border-blue-100">
                <div class="text-[9px] text-blue-400 font-black uppercase mb-1">Alen çš„è¡ŒåŠ¨</div>
                <div id="boyAction" class="text-[12px] text-blue-900 font-bold leading-tight"></div>
            </div>
            <div class="panel ios-card p-5 justify-center border-rose-100">
                <div class="text-[9px] text-rose-400 font-black uppercase mb-1">Mia çš„è¡ŒåŠ¨</div>
                <div id="girlAction" class="text-[12px] text-rose-900 font-bold leading-tight"></div>
            </div>
        </div>

        <!-- æ•°å€¼ -->
        <div class="progress-indicator-section">
            <div class="flex gap-4">
                <div class="progress-container flex-1">
                    <div class="bar-label"><span>é†‰é…’å€¼ (0-10)</span><span id="drunkNum">0/10</span></div>
                    <div class="progress-bar"><div id="drunkBar" class="progress-fill"></div></div>
                </div>
                <div class="progress-container flex-1">
                    <div class="bar-label"><span>æ€’æ°”å€¼ (0-100+)</span><span id="angerNum">0</span></div>
                    <div class="progress-bar"><div id="angerBar" class="progress-fill"></div></div>
                </div>
            </div>
        </div>

        <!-- AI å¤ç›˜ -->
        <div class="insight-section">
            <div id="aiInsight" class="h-full ios-card flex items-center px-6 text-[11px] text-slate-600 font-medium leading-relaxed">
                <span id="insightText">ç­‰å¾…ç³»ç»Ÿåˆå§‹åŒ–...</span>
            </div>
        </div>

        <!-- å¿ƒè·¯å†ç¨‹ -->
        <div class="thought-section flex gap-3">
            <div class="panel">
                <div id="boyOS" class="ios-card thought-bubble opacity-0"></div>
            </div>
            <div class="panel">
                <div id="girlOS" class="ios-card thought-bubble opacity-0"></div>
            </div>
        </div>

        <!-- åœºæ™¯å›¾ -->
        <div class="scene-section flex gap-3">
            <div class="panel ios-card overflow-hidden" id="boyCanvas"></div>
            <div class="panel ios-card overflow-hidden relative" id="girlCanvas">
                <div id="girlSceneContainer" class="w-full h-full"></div>
                <div id="stamp" class="absolute inset-0 flex items-center justify-center opacity-0 scale-150 transition-all duration-1000 pointer-events-none z-50">
                    <div class="bg-white/95 border-[4px] border-red-600 text-red-600 font-black text-2xl px-10 py-4 rotate-[-15deg] rounded-2xl tracking-[0.2em] shadow-2xl">å·²æ‹‰é»‘</div>
                </div>
            </div>
        </div>
    </main>

    <!-- é“æ­‰ä¿¡æ¨¡æ€æ¡† -->
    <div id="reflectionModal" class="fixed inset-0 flex items-center justify-center px-6 py-10 bg-slate-900/50 backdrop-blur-md hidden opacity-0 transition-opacity duration-500 z-[2000]">
        <div class="w-full max-w-md bg-[#fffaf5] rounded-[40px] overflow-hidden flex flex-col shadow-2xl h-[85vh] border-8 border-white">
            <div class="p-8 md:p-10 overflow-y-auto flex-1 text-slate-800 font-serif" id="letterContent">
                <div class="mb-8 border-b-2 border-orange-100 pb-4">
                    <h2 class="text-xl font-bold text-orange-900">Alen çš„äº²ç¬”é“æ­‰ä¿¡</h2>
                </div>
                <div class="text-[14px] leading-[2] space-y-6 text-slate-700">
                    <p>äº²çˆ±çš„ Miaï¼š</p>
                    <p>ä»Šå¤©ï¼Œæˆ‘ç”¨äº†ä¸€å¤©æ—¶é—´æ¥åå¤å¤ç›˜æˆ‘æ˜¨æ™šçŠ¯ä¸‹çš„é”™è¯¯ï¼Œæˆ‘åˆ—ä¸‹äº†æ—¶é—´è½´ï¼Œä¸€ç‚¹ç‚¹çš„æ‹¨å¼€æ˜¨æ™šæˆ‘ä»¬åŒæ–¹çš„æƒ…ç»ªè¿·é›¾ï¼Œæˆ‘æƒ³ï¼Œæˆ‘åº”è¯¥æ˜¯å½»åº•ææ¸…æ¥šäº†æˆ‘çš„ç½ªè¡Œã€‚</p>
                    <div class="space-y-4 py-4 border-y border-orange-200 bg-orange-50/50 px-4 rounded-xl">
                        <p><strong>ç¬¬ä¸€ï¼Œæ—¶é—´å¤±ä¿¡ï¼š</strong>10ç‚¹åŠåˆ°11ç‚¹å°±åº”è¯¥èµ°äº†ï¼Œæˆ‘éšå£è·Ÿä½ æ‰¿è¯ºï¼Œå´å–åˆ°äº†12ç‚¹ã€‚</p>
                        <p><strong>ç¬¬äºŒï¼Œè®©ä½ çš„ä¿¡ä»»å’Œå®‰å…¨æ„Ÿæ¸…é›¶ï¼š</strong>åœ¨ä½ æ€’æ°”é£é€Ÿä¸Šå‡æ—¶ï¼Œæˆ‘å› ä¸ºé†‰é…’è€Œé€‰æ‹©äº†å¿½è§†ï¼Œç”šè‡³æŒ‚æ–­ç”µè¯ï¼Œä¸¥é‡çš„æŸå¤±äº†ä½ çš„ä¿¡ä»»ï¼Œè®©ä½ ç¬é—´å®‰å…¨æ„Ÿå½’é›¶ã€‚</p>
                        <p><strong>ç¬¬ä¸‰ï¼Œæ•·è¡çš„é“æ­‰ï¼š</strong>æŒ‚æ–­ç”µè¯çš„é‚£ä¸€åˆ»èµ·ï¼Œä½ çš„æ„¤æ€’å€¼å°±éšç€æ—¶é—´æŒ‡æ•°çº§ä¸Šå‡ï¼Œè€Œæˆ‘å´æ²¡æœ‰ç¬¬ä¸€æ—¶é—´æ„è¯†åˆ°ï¼Œè€Œæ˜¯ç£¨ç£¨å”§å”§çš„åˆ°äº†å®¶æ‰å¼€å§‹å‡†å¤‡è¡¥æ•‘ï¼Œå´ä¸ºæ—¶å·²æ™šã€‚</p>
                    </div>
                    <p>æˆ‘æƒ³å†æ¬¡çš„ï¼Œè¯šæ³åœ°å’Œä½ é“æ­‰ï¼Œä½ æ˜¯ä¸ªæåº¦éœ€è¦å®‰å…¨æ„Ÿçš„äººï¼Œå¯æ˜¯æˆ‘å´ä¸€æ¬¡åˆä¸€æ¬¡å¿½è§†äº†ä½ çš„æ„Ÿå—ï¼Œæˆ‘çœŸçš„æ„è¯†åˆ°äº†æˆ‘çš„é”™è¯¯ï¼Œæˆ‘ä¹Ÿè·Ÿä½ æ‰¿è¯ºæˆ‘ä»¥åä¼šä¸¥æ ¼é‡è§†ä½ çš„æƒ…ç»ªæœ¬è´¨ï¼Œä¸è®©ä½ ä»»ä½•ä¸€ç‚¹å®‰å…¨æ„Ÿç¼ºå¤±ï¼Œæˆ‘ä¼šå§‹ç»ˆæŠŠä½ æ”¾åˆ°å¿ƒä¸­çš„ç¬¬ä¸€ä½ã€‚</p>
                    <p>å¸Œæœ›ä½ èƒ½å¤Ÿçœ‹åˆ°æˆ‘çš„åæ€å’Œæ‚”æ”¹ï¼Œè¯·ä½ åŸè°…æˆ‘ã€‚</p>
                    <div class="pt-8 text-right">
                        <p class="font-bold text-lg text-slate-900 italic">å‘å¾®çš„ Alen æ•¬å‘ˆ</p>
                        <p class="text-xs text-slate-400 mt-1">2025å¹´12æœˆ25æ—¥</p>
                    </div>
                </div>
            </div>
            <button id="closeModalBtn" class="bg-orange-600 text-white w-full py-6 text-sm font-black tracking-[0.2em] uppercase active:scale-95 transition-transform">æ”¶èµ·é“æ­‰ä¿¡</button>
        </div>
    </div>

    <script>
        const timeline = [
            {
                time: "10:33", title: "åˆæ­¥æ¢æŸ¥",
                boy: "æ‰“ç”µè¯ï¼šå¹²å˜›å‘¢ï¼Œæƒ³ä½ ã€‚",
                boyOS: "ä¸çŸ¥é“ä½ ç”Ÿæ°”æ²¡æœ‰ï¼Œæ‰“ä¸ªç”µè¯æ¢æŸ¥ä¸€ä¸‹",
                boyEmoji: "ğŸ“", drunk: 3,
                girl: "æ¥ç”µè¯ï¼šåˆ·çŸ­å‰§ï¼Œå‹¿æ‰°",
                girlOS: "æ— è¶£",
                girlEmoji: "ğŸ“±", anger: 5,
                insight: "Alen è¯•å›¾è¿›è¡Œè¯•æ¢æ€§çš„æ¸©æŸ”å®‰æŠšï¼Œä½† Mia æ­¤æ—¶å¤„äºæƒ…ç»ªå¹³æ·¡æœŸã€‚"
            },
            {
                time: "11:19", title: "é¢„è­¦ä¿¡å·",
                boy: "â€œæˆ‘å¿«ç»“æŸäº†å“ˆï¼Œé©¬ä¸Šèµ°â€",
                boyOS: "è¦ç”Ÿæ°”äº†ï¼Œå¾—èµ¶å¿«ç»“æŸäº†",
                boyEmoji: "ğŸº", drunk: 5,
                girl: "æ‰“ç”µè¯ï¼šè¿˜ä¸èµ°ï¼Ÿ",
                girlOS: "æˆ‘è¦å¼€å§‹é—¹äº†",
                girlEmoji: "ğŸ’¢", anger: 20,
                insight: "Mia å·²ç»å¼€å§‹é€šè¿‡è¯¢é—®æ–½å‹ï¼ŒAlen è§‰å¯Ÿåˆ°å±æœºä½†ä½ä¼°äº†çˆ†å‘åŠ›ã€‚"
            },
            {
                time: "11:30", title: "è­¦å‘Šå‡çº§",
                boy: "å‘å‡ºå¾®ä¿¡æ¶ˆæ¯ï¼šåœ£è¯å¿«ä¹ï¼Œè€æ½˜",
                boyOS: "çªç„¶å‘ç°æ˜¯åœ£è¯äº†å•Šï¼Œæˆ‘çœŸè¯¥æ­»",
                boyEmoji: "ğŸ„", drunk: 6,
                girl: "å›å¤å¾®ä¿¡ï¼šè¿˜æ²¡åˆ°ï¼Ÿâ€”â€”è¢«å¿½è§†çš„è­¦å‘Šä¿¡å·",
                girlOS: "ä½ ä¸æ˜¯å·²ç»èµ°äº†ï¼Ÿ",
                girlEmoji: "â³", anger: 40,
                insight: "åœ£è¯èŠ‚ç‚¹çš„ç‰¹æ®Šæ€§è¢«å¿½ç•¥ï¼Œå¤±ä¿¡çš„ç§å­å¼€å§‹åœ¨ Mia å¿ƒä¸­å‘èŠ½ã€‚"
            },
            {
                time: "11:54", title: "è‡´å‘½è¯¯è§£",
                boy: "è§†é¢‘ç”µè¯â€”æŒ‚æ–­ï¼ˆä½œæ­»è¡Œä¸ºï¼‰ï¼›å›å¤ï¼šç°åœ¨èµ°",
                boyOS: "å®Œäº†ï¼Œè¦èµ¶ç´§èµ°äº†ï¼Œå›å»å¥½å¥½å®‰æŠšå’Œé“æ­‰å§",
                boyEmoji: "ğŸ“´", drunk: 8,
                girl: "å‘å‡ºå¾®ä¿¡æ¶ˆæ¯ï¼šï¼Ÿï¼›è§†é¢‘ç”µè¯è¢«æŒ‚æ–­",
                girlOS: "ï¼Ÿï¼Ÿï¼ŸæŒ‚æˆ‘ç”µè¯ï¼Ÿå‡ºè½¨äº†ï¼Ÿï¼Ÿï¼Ÿ",
                girlEmoji: "ğŸ’”", anger: 80,
                insight: "ç”±äºé†‰é…’å¯¼è‡´çš„é™æ™ºæ“ä½œï¼Œç›´æ¥è§¦å‘äº†å¯¹æ–¹æœ€æç«¯çš„çŒœå¿Œã€‚"
            },
            {
                time: "11:56", title: "ä½ä¼°äº‹æ€",
                boy: "å›å¤è§†é¢‘ç”µè¯ï¼šèµ°äº†",
                boyOS: "å«Œæˆ‘å¤ªæ™šç”Ÿæ°”äº†ï¼Œèµ¶ç´§ä¸Šä¸ªå•æ‰€ï¼Œæ”¶æ‹¾ä¸‹å‡†å¤‡èµ°äº†ï¼Œå‡ºå»å†å›ï¼ˆä½ä¼°äº‹æ€ä¸¥é‡æ€§ï¼‰",
                boyEmoji: "ğŸš½", drunk: 9,
                girl: "å‘å‡ºå¾®ä¿¡æ¶ˆæ¯ï¼šåœ¨å‡ºè½¨ï¼Ÿ",
                girlOS: "è¡Œè¡Œè¡Œï¼Œå–é…’å–åˆ°è¿™ä¹ˆæ™šï¼ŒæŒ‚æˆ‘ç”µè¯ï¼Œè¿˜å‡ºè½¨ï¼Ÿåˆ†æ‰‹å§",
                girlEmoji: "ğŸ”¥", anger: 100,
                insight: "Alen çš„ç£¨å½åœ¨å¯¹æ–¹çœ‹æ¥æ˜¯ä¸è¯šå®çš„ç‹¡è¾©ï¼Œæ„¤æ€’å€¼æ­£å¼ç ´ç™¾ã€‚"
            },
            {
                time: "12:18", title: "æœ€åç¨»è‰",
                boy: "ï¼ˆè¿˜ä¸çŸ¥é“è¢«å®šæ€§ä¸ºå‡ºè½¨äº†ï¼‰å…ˆæŠŠå‘¨é€å›å»",
                boyOS: "å…ˆæŠŠå‘¨é€å›å»ï¼Œç„¶åæ‰“ä¸ªç”µè¯æŠ¥å¹³å®‰",
                boyEmoji: "ğŸš—", drunk: 9,
                girl: "å‘å‡ºå¾®ä¿¡æ¶ˆæ¯ï¼šç»™ä½ çš„è‡ªç”±ä¸æ˜¯è®©ä½ è¹¬é¼»å­ä¸Šè„¸çš„â€”â€”æ‹‰é»‘",
                girlOS: "è¡Œï¼Œå‡ºè½¨æ˜¯å§ï¼Œå†è§äº†ï¼Œä¿¡ä»»ä»æ­¤å´©å¡Œ",
                girlEmoji: "ğŸš«", anger: 200, status: "BLACKED",
                insight: "åœ¨å¯¹æ–¹æåº¦ä¸å®‰æ—¶ä¼˜å…ˆé€‰æ‹©ç¤¾äº¤ç¤¼ä»ªï¼Œæˆäº†å‹æ­»éª†é©¼çš„æœ€åä¸€æ ¹ç¨»è‰ã€‚"
            },
            {
                time: "12:39", title: "ç»ˆå±€è¡¥æ•‘",
                boy: "åˆ°å®¶ï¼Œèµ¶ç´§æ‰“è§†é¢‘ç”µè¯è§£é‡Š",
                boyOS: "æ±‚æ±‚äº†ï¼Œåˆ«ç”Ÿå¤ªå¤§æ°”",
                boyEmoji: "ğŸ˜«", drunk: 9,
                girl: "æŒ‚æ–­ï¼ŒæŒ‚æ–­ï¼ŒæŒ‚æ–­ï¼ˆå·²æ‹‰é»‘ï¼‰",
                girlOS: "æ‹œæ‹œï¼Œå†ä¹Ÿä¸è§",
                girlEmoji: "â¬›", anger: 300,
                insight: "ä¿¡ä»»æ¸…é›¶åçš„è¡¥æ•‘å·²æ— æµäºäº‹ï¼Œå…³ç³»è¿›å…¥ç»å¯¹å†°å°æœŸã€‚"
            }
        ];

        let step = -1;

        window.onload = () => {
            document.getElementById('startBtn').onclick = startApp;
            document.getElementById('floatingPrevBtn').onclick = prevStep;
            document.getElementById('floatingNextBtn').onclick = nextStep;
            document.getElementById('closeModalBtn').onclick = closeModal;
        };

        function startApp() {
            document.getElementById('introOverlay').style.opacity = '0';
            setTimeout(() => {
                document.getElementById('introOverlay').style.display = 'none';
                document.getElementById('floatingNextBtn').style.display = 'flex';
                step = 0;
                updateUI();
            }, 600);
        }

        function nextStep() {
            if (step >= timeline.length - 1) {
                const nextBtn = document.getElementById('floatingNextBtn');
                if (nextBtn.classList.contains('final')) {
                    const modal = document.getElementById('reflectionModal');
                    modal.classList.remove('hidden');
                    setTimeout(() => modal.style.opacity = '1', 10);
                } else {
                    nextBtn.classList.add('final');
                    document.getElementById('arrowIcon').style.display = 'none';
                    document.getElementById('finalText').classList.remove('hidden');
                }
                return;
            }
            step++;
            updateUI();
        }

        function prevStep() {
            if (step <= 0) return;
            step--;
            updateUI();
        }

        function updateUI() {
            const d = timeline[step];
            document.getElementById('floatingPrevBtn').style.display = step === 0 ? 'none' : 'flex';
            
            if (step < timeline.length - 1) {
                const nextBtn = document.getElementById('floatingNextBtn');
                nextBtn.classList.remove('final');
                document.getElementById('arrowIcon').style.display = 'block';
                document.getElementById('finalText').classList.add('hidden');
            } else {
                const nextBtn = document.getElementById('floatingNextBtn');
                nextBtn.classList.add('final');
                document.getElementById('arrowIcon').style.display = 'none';
                document.getElementById('finalText').classList.remove('hidden');
            }

            document.getElementById('currentTime').innerText = d.time;
            document.getElementById('sceneTitle').innerText = d.title;

            document.getElementById('boyAction').innerText = d.boy;
            document.getElementById('girlAction').innerText = d.girl;

            const bOS = document.getElementById('boyOS');
            bOS.innerHTML = `<span class="text-[9px] font-black opacity-30 mb-1 uppercase tracking-tighter">Alen çš„å¿ƒè·¯å†ç¨‹:</span> ${d.boyOS}`;
            bOS.style.opacity = '1';

            const gOS = document.getElementById('girlOS');
            gOS.innerHTML = `<span class="text-[9px] font-black opacity-30 mb-1 uppercase tracking-tighter">Mia çš„å¿ƒè·¯å†ç¨‹:</span> ${d.girlOS}`;
            gOS.style.opacity = '1';

            const dFill = document.getElementById('drunkBar');
            const aFill = document.getElementById('angerBar');
            dFill.style.width = (d.drunk * 10) + '%';
            dFill.style.backgroundColor = d.drunk > 7 ? '#4c1d95' : '#3b82f6';
            aFill.style.width = Math.min(d.anger / 2, 100) + '%';
            aFill.style.backgroundColor = d.anger >= 100 ? '#e11d48' : '#f97316';

            document.getElementById('drunkNum').innerText = d.drunk + '/10';
            document.getElementById('angerNum').innerText = d.anger >= 300 ? 'æ— ä¸Šé™' : d.anger;

            document.getElementById('boyCanvas').innerHTML = `<div class="emoji-scene">${d.boyEmoji}</div>`;
            document.getElementById('girlSceneContainer').innerHTML = `<div class="emoji-scene">${d.girlEmoji}</div>`;
            document.getElementById('insightText').innerText = d.insight;

            const girlCard = document.getElementById('girlCanvas');
            if (d.anger >= 100) girlCard.classList.add('vibrate');
            else girlCard.classList.remove('vibrate');

            const s = document.getElementById('stamp');
            if (d.status === "BLACKED") {
                s.style.opacity = '1';
                s.style.transform = 'scale(1) rotate(-15deg)';
            } else {
                s.style.opacity = '0';
                s.style.transform = 'scale(1.5) rotate(-15deg)';
            }
        }

        function closeModal() {
            const modal = document.getElementById('reflectionModal');
            modal.style.opacity = '0';
            setTimeout(() => modal.classList.add('hidden'), 500);
        }
    </script>
</body>
</html>
